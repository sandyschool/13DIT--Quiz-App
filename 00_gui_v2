'''This quiz application allows users, (specifically high-school students) to learn new fun facts and test their knowledge
on history and science questions
 Author- Sandy Baduge'''

#Imports
import tkinter as tk
from tkinter import messagebox
from PIL import Image, ImageTk
import json

class TriviaQuiz:
    # Instructions window for the user.
    def show_instructions(self, root):
        # Create a new window for instructions
        instructions = tk.Toplevel(root)
        instructions.title("Trivia Quiz Game Instructions")
        instructions.geometry("600x600")
        instructions.resizable(False, False)

        # Instruction text to be displayed.
        instructions_text = (
            "Welcome to the General Knowledge Quiz!\n\n"
            "Instructions:\n"
            "1. Enter your name in the provided field.\n"
            "2. Select a topic, either 'Science' or 'History'.\n"
            "3. Click 'Submit' to begin.\n"
            "4. Answer the questions by selecting the correct option.\n"
            "5. You can skip a question if you're unsure by clicking 'Skip Question'.\n"
            "6. After answering all questions, your score will be displayed.\n"
            "7. You can retry the quiz by clicking 'Retry Quiz'.\n"
            "8. Click 'Start Quiz' to continue to new window. \n"
            "8. Enjoy learning new facts and testing your knowledge!\n\n"
        )
        def on_start():
            instructions.destroy()
            self.root.deiconify()
        # Instructions will show up on window
        instruction_label = tk.Label(instructions, text=instructions_text, font=("Open Sans", 12),fg="black", bg="light green", justify="center", wraplength=600)
        instruction_label.pack(pady=(15,20), padx=10)

        # Button to close the instructions window
        start_button = tk.Button(instructions, text="Start Quiz", command= on_start,font=("Open Sans", 14), bg="light green", fg="black")
        start_button.pack(pady=20)

    # Main menu window
    def __init__(self, root):
        self.root = root
        self.root.title("Trivia Quiz Game")
        self.root.geometry("600x600")
        root.withdraw ()# hide before show instructions function
        self.root.resizable(False, False)
        self.category = None
        self.background_image()
        self.main_menu()
        self.show_instructions(self.root)  # Show instructions when it starts
    
    # Background image for the main window
    def background_image(self):
        # Insert background image
        bg_image = Image.open("C:/Users/prasa/OneDrive/Desktop/Baduge, Sandy - 13DIT Project 91906/bg2.png")
        bg_image = bg_image.resize((600, 600))
        self.bg_photo = ImageTk.PhotoImage(bg_image, master=self.root)

        self.bg_label = tk.Label(self.root, image=self.bg_photo)
        self.bg_label.place(x=0, y=0, relwidth=1, relheight=1)
        self.bg_label.lower()
        self.bg_label.place(x=0, y=0, relwidth=1, relheight=1) 

    # Main menu window to start quiz  
    def main_menu(self):
        # Title
        title_label = tk.Label(self.root, text="Trivia Quiz", font=("Impact", 24), anchor="center", bg="#E28047")
        title_label.pack(pady=(5, 20), padx=10)

        # Name entry of user
        name_label = tk.Label(text="Enter your name:", bg="#E7973B", font=("Lucida Sans", 20)).pack(pady=(10))
        self.name_entry = tk.Entry(self.root, width=16, validate='key')
        self.name_entry.pack(pady=(10, 15), padx=10)

        # Submit button to start quiz
        submit_button = tk.Button(self.root, text="Submit", command=self.enter_name)
        submit_button.pack(pady=(10, 0))

        # Exit button
        tk.Button(self.root, text="Quit Game", command=self.root.destroy, font=("Open Sans", 14), bg="light green", fg="black").pack(pady=(10, 0))


    def enter_name(self):
        # Validate user input 
        name = self.name_entry.get().strip()
        if not name:
            messagebox.showwarning("Error! Name cannot be blank", "Please enter your name!")
            return
        elif not name.isalpha():
            messagebox.showwarning("Error!", "Name must only contain letters!")
            return
        elif len(name) < 2:
            messagebox.showwarning("Error!", "Name must be at least 2 characters long!")
            return
        elif len(name) > 16:
            messagebox.showwarning("Error!", "Name must be shorter than 16 characters!")
            return
        else:
            # Welcome user name
            messagebox.showinfo("Welcome!", f"Welcome {name} to the Trivia Quiz Game!")
            self.root.withdraw()
    
    def select_category(self, category):
        # Function for selecting a category
        category = tk.Toplevel(self.root)
        category.title("Select Category")
        category.geometry("400x500")
        category.resizable(False, False)

        # Category selection buttons
        tk.Label(self.root, text="Select category:", bg="#CE964D", font=("Open Sans", 14)).pack(pady=(0, 5))

        science_button = tk.Button(self.root, text="Science", bg="#DDA24A", font=("Open Sans", 14),fg='black', command=lambda: self.start_quiz("Science"))
        science_button.pack(pady=(0, 5))

        history_button = tk.Button(self.root, text="History", bg="#DD8E4D", font=("Open Sans", 14),fg='black', command=lambda: self.start_quiz("History"))
        history_button.pack(pady=(0, 5))
    
    def start_quiz(self, category):
        # Function to start the quiz based on the selected category
        self.category = category
        self.root.destroy() # Close the selection window

        # Load questions
        self.load_questions(category + ".json")
            
    def load_questions(self):
        # Function to create the quiz window based on the selected category
        if self.category == "Science":
            # Load science questions and start the quiz
            self.load_questions("Science.json")
        elif self.category == "History":
            # Load history questions and start the quiz
            self.load_questions("History.json")


if __name__ == "__main__":
    root = tk.Tk()
    app = TriviaQuiz(root)
    root.mainloop()
